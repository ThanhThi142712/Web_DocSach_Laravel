!function(e){e.fn.extend({autocomplete_suggestion:function(t,a){var n="string"==typeof t;return a=e.extend({},e.Autocompleter.defaults,{url:n?t:null,data:n?null:t,delay:n?e.Autocompleter.defaults.delay:10,max:a&&!a.scroll?20:268},a),a.highlight=a.highlight||function(e){return e},a.formatMatch=a.formatMatch||a.formatItem,this.each(function(){new e.Autocompleter(this,a)})},result:function(e){return this.bind("result",e)},enter:function(e){return this.bind("enter",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,a){function n(){var e=T.selected();if(!e)return v.trigger("enter",[v.val()]),!1;var t=e.result;if(C=t,a.multiple){var n=o(v.val());n.length>1&&(t=n.slice(0,n.length-1).join(a.multipleSeparator)+a.multipleSeparator+t),t+=a.multipleSeparator}return s(),v.trigger("result",[e.data,e.value]),v.val(t),!0}function r(e,t){if(p!=g.DEL){var n=v.val();(t||n!=C)&&(C=n,(n=i(n)).length>=a.minChars?(v.addClass(a.loadingClass),a.matchCase||(n=n.toLowerCase()),f(n,c,s)):(d(),T.hide()))}else T.hide()}function o(t){if(!t)return[""];var n=t.split(a.multipleSeparator),r=[];return e.each(n,function(t,a){e.trim(a)&&(r[t]=e.trim(a))}),r}function i(e){if(!a.multiple)return e;var t=o(e);return t[t.length-1]}function l(n,r){a.autoFill&&i(v.val()).toLowerCase()==n.toLowerCase()&&p!=g.BACKSPACE&&(v.val(v.val()+r.substring(i(C).length)),e.Autocompleter.Selection(t,C.length,C.length+r.length))}function u(){clearTimeout(m),m=setTimeout(s,200)}function s(){var n=T.visible();T.hide(),clearTimeout(m),d(),a.mustMatch&&v.search(function(e){if(!e)if(a.multiple){var t=o(v.val()).slice(0,-1);v.val(t.join(a.multipleSeparator)+(t.length?a.multipleSeparator:""))}else v.val("")}),n&&e.Autocompleter.Selection(t,t.value.length,t.value.length)}function c(e,t){t&&t.length&&A?(d(),T.display(t,e),l(e,t[0].value),T.show()):s()}function f(n,r,o){a.matchCase||(n=n.toLowerCase());var l=b.load(n);if(l&&l.length)r(n,l);else if("string"==typeof a.url&&a.url.length>0){var u={timestamp:+new Date};e.each(a.extraParams,function(e,t){u[e]="function"==typeof t?t():t}),e.ajax({mode:"abort",port:"autocomplete"+t.name,dataType:a.dataType,url:a.url,data:e.extend({q:i(n)},u),success:function(e){var t=a.parse&&a.parse(e,n)||h(e);b.add(n,t),r(n,t)}})}else T.emptyList(),o(n)}function h(t){for(var n=[],r=t.split("\n"),o=0;o<r.length;o++){var i=e.trim(r[o]);i&&(i=i.split("|"),n[n.length]={data:i,value:i[0],result:a.formatResult&&a.formatResult(i,i[0])||i[0]})}return n}function d(){v.removeClass(a.loadingClass)}var m,p,g={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},v=e(t).attr("autocomplete","off").addClass(a.inputClass),C="",b=e.Autocompleter.Cache(a),A=0,w={mouseDownOnSelect:!1},T=e.Autocompleter.Select(a,t,n,w);v.bind("keydown.autocomplete",function(t){switch(p=t.keyCode,t.keyCode){case g.UP:t.preventDefault(),T.visible()?T.prev():r(0,!0);break;case g.DOWN:t.preventDefault(),T.visible()?T.next():r(0,!0);break;case g.PAGEUP:t.preventDefault(),T.visible()?T.pageUp():r(0,!0);break;case g.PAGEDOWN:t.preventDefault(),T.visible()?T.pageDown():r(0,!0);break;case a.multiple&&","==e.trim(a.multipleSeparator)&&g.COMMA:case g.TAB:case g.RETURN:n();break;case g.ESC:T.hide();break;default:clearTimeout(m),m=setTimeout(r,a.delay)}}).focus(function(){A++}).blur(function(){A=0,w.mouseDownOnSelect||(T.hide(),u())}).click(function(){A++>1&&!T.visible()&&r(0,!0)}).bind("search",function(){function t(e,t){var n;if(t&&t.length)for(var r=0;r<t.length;r++)if(t[r].result.toLowerCase()==e.toLowerCase()){n=t[r];break}"function"==typeof a?a(n):v.trigger("result",n&&[n.data,n.value])}var a=arguments.length>1?arguments[1]:null;e.each(o(v.val()),function(e,a){f(a,t,t)})}).bind("flushCache",function(){b.flush()}).bind("setOptions",function(){e.extend(a,arguments[1]),"data"in arguments[1]&&b.populate()}).bind("unautocomplete",function(){T.unbind(),v.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:100,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:13,max:100,mustMatch:!1,extraParams:{},selectFirst:!1,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!1,scrollHeight:180},e.Autocompleter.Cache=function(t){function a(e,a){t.matchCase||(e=e.toLowerCase());var n=e.indexOf(a);return"word"==t.matchContains&&(n=e.toLowerCase().search("\\b"+a.toLowerCase())),-1!=n&&(0==n||t.matchContains)}function n(e,a){l>t.cacheLength&&o(),i[e]||l++,i[e]=a}function r(){if(!t.data)return!1;var a={},r=0;t.url||(t.cacheLength=1),a[""]=[];for(var o=0,i=t.data.length;o<i;o++){var l=t.data[o];l="string"==typeof l?[l]:l;var u=t.formatMatch(l,o+1,t.data.length);if(!1!==u){var s=u.charAt(0).toLowerCase();a[s]||(a[s]=[]);var c={value:u,data:l,result:t.formatResult&&t.formatResult(l)||u};a[s].push(c),r++<t.max&&a[""].push(c)}}e.each(a,function(e,a){t.cacheLength++,n(e,a)})}function o(){i={},l=0}var i={},l=0;return setTimeout(r,25),{flush:o,add:n,populate:r,load:function(n){if(!t.cacheLength||!l)return null;if(!t.url&&t.matchContains){s=[];for(var r in i)if(r.length>0){var o=i[r];e.each(o,function(e,t){a(t.value,n)&&s.push(t)})}return s}if(i[n])return i[n];if(t.matchSubset)for(var u=n.length-1;u>=t.minChars;u--)if(o=i[n.substr(0,u)]){var s=[];return e.each(o,function(e,t){a(t.value,n)&&(s[s.length]=t)}),s}return null}}},e.Autocompleter.Select=function(t,a,n,r){function o(){C&&(d=e("<div/>").hide().addClass(t.resultsClass).css("position","fixed").appendTo(document.body),m=e("<ul/>").appendTo(d).mouseover(function(t){i(t).nodeName&&"LI"==i(t).nodeName.toUpperCase()&&(g=e("li",m).removeClass(p.ACTIVE).index(i(t)),e(i(t)).addClass(p.ACTIVE))}).click(function(t){return e(i(t)).addClass(p.ACTIVE),n(),!0}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),t.width>0&&d.css("width",t.width),C=!1)}function i(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function l(n){f.slice(g,g+1).removeClass(p.ACTIVE),u(n);var r=f.slice(g,g+1).addClass(p.ACTIVE);if(t.scroll){var o=0;f.slice(0,g).each(function(){o+=this.offsetHeight}),o+r[0].offsetHeight-m.scrollTop()>m[0].clientHeight?m.scrollTop(o+r[0].offsetHeight-m.innerHeight()):o<m.scrollTop()&&m.scrollTop(o)}var i=f&&f.filter("."+p.ACTIVE),l=i&&i.length&&e.data(i[0],"ac_data");e(a).attr("autocomplete","off").val(l.result)}function u(e){(g+=e)<0?g=f.size()-1:g>=f.size()&&(g=0)}function s(e){return t.max&&t.max<e?t.max:e}function c(){m.empty();for(var a=s(h.length),n=0;n<a;n++)if(h[n]){var r=t.formatItem(h[n].data,n+1,a,h[n].value,v);if(!1!==r){var o=e("<li/>").html(t.highlight(r,v)).addClass(n%2==0?"ac_even":"ac_odd").appendTo(m)[0];e.data(o,"ac_data",h[n])}}f=m.find("li"),t.selectFirst&&(f.slice(0,1).addClass(p.ACTIVE),g=0),e.fn.bgiframe&&m.bgiframe()}var f,h,d,m,p={ACTIVE:"ac_over"},g=-1,v="",C=!0;return{display:function(e,t){o(),h=e,v=t,c()},next:function(){l(1)},prev:function(){l(-1)},pageUp:function(){l(0!=g&&g-8<0?-g:-8)},pageDown:function(){l(g!=f.size()-1&&g+8>f.size()?f.size()-1-g:8)},hide:function(){d&&d.hide(),f&&f.removeClass(p.ACTIVE),g=-1},visible:function(){return d&&d.is(":visible")},current:function(){return this.visible()&&(f.filter("."+p.ACTIVE)[0]||t.selectFirst&&f[0])},show:function(){var n=e(a).offset();if(d.css({width:"string"==typeof t.width||t.width>0?t.width:e(a).width(),top:n.top-e(document).scrollTop()+(a.offsetHeight-2),left:n.left+15}).show(),t.scroll){m.scrollTop(0),m.css({maxHeight:t.scrollHeight,overflow:"auto"})}},selected:function(){var t=f&&f.filter("."+p.ACTIVE).removeClass(p.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},emptyList:function(){m&&m.empty()},unbind:function(){d&&d.remove()}}},e.Autocompleter.Selection=function(e,t,a){if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t),n.moveEnd("character",a),n.select()}else e.setSelectionRange?e.setSelectionRange(t,a):e.selectionStart&&(e.selectionStart=t,e.selectionEnd=a);e.focus()}}(jQuery);